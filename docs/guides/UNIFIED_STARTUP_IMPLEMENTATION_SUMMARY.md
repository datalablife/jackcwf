# ğŸ“Š ç»Ÿä¸€å¯åŠ¨ç³»ç»Ÿ - å®ç°æ€»ç»“ä¸å¯¹æ¯”

åŸºäº `UNIFIED_STARTUP_SOLUTION_ANALYSIS.md` çš„æ·±åº¦åˆ†æ

---

## ğŸ¯ æ ¸å¿ƒç»“è®º

**æ¨èæ–¹æ¡ˆï¼šåŒç¯å¢ƒæ··åˆå¯åŠ¨ç³»ç»Ÿ**

å½“å‰é¡¹ç›®çš„å¯åŠ¨æ–¹å¼éœ€è¦åŒºåˆ†ä¸¤ç§ç¯å¢ƒï¼š
- **å¼€å‘ç¯å¢ƒ**ï¼šè£¸æœº Linuxï¼ˆæœ¬åœ°å¼€å‘æœåŠ¡å™¨ï¼‰
- **ç”Ÿäº§ç¯å¢ƒ**ï¼šDocker å®¹å™¨ï¼ˆCoolify éƒ¨ç½²å¹³å°ï¼‰

---

## ğŸ“ å¼€å‘ç¯å¢ƒå¯åŠ¨æ–¹å¼

### å¯åŠ¨å‘½ä»¤

```bash
# æ–¹å¼ 1ï¼šæœ€ç®€æ´ï¼ˆæ¨èå½“å‰æ–¹å¼ï¼‰
bash scripts/dev.sh

# æ–¹å¼ 2ï¼šä½¿ç”¨ Makefile
make dev

# æ–¹å¼ 3ï¼šæ‰‹åŠ¨åˆ†ç»ˆç«¯å¯åŠ¨
# ç»ˆç«¯ 1
cd /mnt/d/å·¥ä½œåŒº/äº‘å¼€å‘/working
uv run python -m uvicorn backend.src.main:app --reload --port 8000

# ç»ˆç«¯ 2
cd /mnt/d/å·¥ä½œåŒº/äº‘å¼€å‘/working/frontend
npm run dev
```

### å¼€å‘å¯åŠ¨æµç¨‹å›¾

```
ç”¨æˆ·è¿è¡Œ: ./scripts/dev/start.sh
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ç¯å¢ƒæ£€æµ‹                      â”‚
â”‚   âœ“ æ£€æµ‹æ˜¯å¦åœ¨ Docker å†… -> NO   â”‚
â”‚   âœ“ åŠ è½½ dev.env é…ç½®            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. å¿«é€Ÿé¢„æ£€æŸ¥                    â”‚
â”‚   âœ“ Python 3.12+               â”‚
â”‚   âœ“ Node.js 18+                â”‚
â”‚   âœ“ npm/pnpm                   â”‚
â”‚   âœ“ ç«¯å£å¯ç”¨æ€§ (8000, 5173)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. åç«¯å¯åŠ¨ï¼ˆçƒ­é‡è½½æ¨¡å¼ï¼‰        â”‚
â”‚   âœ“ ä¾èµ–å®‰è£…                     â”‚
â”‚   âœ“ uvicorn --reload            â”‚
â”‚   âœ“ ç›‘å¬ä»£ç å˜åŒ–è‡ªåŠ¨é‡å¯         â”‚
â”‚   ğŸ“ http://localhost:8000      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. å‰ç«¯å¯åŠ¨ï¼ˆVite HMRï¼‰          â”‚
â”‚   âœ“ npm ä¾èµ–å®‰è£…                â”‚
â”‚   âœ“ npm run dev                 â”‚
â”‚   âœ“ Hot Module Replacement      â”‚
â”‚   ğŸ“ http://localhost:5173      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ç›‘æ§å’Œæ—¥å¿—                    â”‚
â”‚   âœ“ å½©è‰²ç»ˆç«¯è¾“å‡º                â”‚
â”‚   âœ“ å®æ—¶æ—¥å¿—æ˜¾ç¤º                â”‚
â”‚   âœ“ Ctrl+C ä¼˜é›…å…³é—­             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¼€å‘ç¯å¢ƒç‰¹ç‚¹

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **å¯åŠ¨è„šæœ¬** | `scripts/dev/start.sh` |
| **çƒ­é‡è½½** | âœ… å®Œå…¨æ”¯æŒï¼ˆUvicorn + Vite HMRï¼‰ |
| **å¯åŠ¨æ—¶é—´** | 10-15 ç§’ |
| **æ—¥å¿—è¾“å‡º** | ç»ˆç«¯ + æ–‡ä»¶ |
| **è°ƒè¯•** | ä¾¿æ·ï¼Œæ”¯æŒè®¾ç½®æ–­ç‚¹ |
| **æ•°æ®åº“** | PostgreSQLï¼ˆäº‘ç«¯ï¼‰ æˆ– SQLiteï¼ˆæœ¬åœ°ï¼‰ |
| **å…³é—­æ–¹å¼** | Ctrl+C ä¼˜é›…å…³é—­ |

### è®¿é—®åœ°å€ï¼ˆå¼€å‘ï¼‰

```
å‰ç«¯åº”ç”¨:   http://localhost:5173
åç«¯ API:    http://localhost:8000
Swagger Doc: http://localhost:8000/docs
ReDoc Doc:   http://localhost:8000/redoc
æ—¥å¿—æ–‡ä»¶:    logs/dev/
```

---

## ğŸ³ ç”Ÿäº§ç¯å¢ƒå¯åŠ¨æ–¹å¼ï¼ˆCoolifyï¼‰

### å¯åŠ¨æµç¨‹

```
Coolify æ£€æµ‹åˆ° GitHub æ¨é€
         â†“
Coolify æ‹‰å–ä»£ç å¹¶æ„å»º Docker é•œåƒ
         â†“
Coolify è¿è¡Œ Docker å®¹å™¨
         â†“
         ENTRYPOINT: /app/scripts/container/entrypoint.sh
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ç¯å¢ƒæ£€æµ‹                          â”‚
â”‚   âœ“ æ£€æµ‹æ˜¯å¦åœ¨ Docker å†… -> YES      â”‚
â”‚   âœ“ åŠ è½½ container/config.env        â”‚
â”‚   âœ“ è¦†ç›– Coolify æ³¨å…¥çš„ç¯å¢ƒå˜é‡      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. å®Œæ•´çš„ç”Ÿäº§çº§é¢„æ£€æŸ¥                â”‚
â”‚   âœ“ æ‰€æœ‰ä¾èµ–éªŒè¯                     â”‚
â”‚   âœ“ æ•°æ®åº“è¿æ¥ï¼ˆä¸¥æ ¼ï¼‰               â”‚
â”‚   âœ“ ç£ç›˜ç©ºé—´ã€å†…å­˜æ£€æŸ¥               â”‚
â”‚   âœ“ å®‰å…¨é…ç½®éªŒè¯                     â”‚
â”‚   âœ— å¤±è´¥åˆ™ç«‹å³é€€å‡º                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. æ•°æ®åº“è¿ç§»ï¼ˆå…³é”®ï¼ï¼‰              â”‚
â”‚   âœ“ è¿è¡Œ Alembic upgrade head        â”‚
â”‚   âœ“ å¦‚æœå¤±è´¥ï¼Œå›æ»šå¹¶ä¸­æ­¢å¯åŠ¨         â”‚
â”‚   âœ“ æˆåŠŸåæ‰ç»§ç»­                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. å‰ç«¯æ„å»º                          â”‚
â”‚   âœ“ è¿è¡Œ npm ci --production         â”‚
â”‚   âœ“ npm run build ç”Ÿæˆé™æ€æ–‡ä»¶        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. åç«¯å¯åŠ¨ï¼ˆç”Ÿäº§æ¨¡å¼ï¼‰              â”‚
â”‚   âœ“ uvicorn 4 workersï¼ˆå¤šè¿›ç¨‹ï¼‰      â”‚
â”‚   âœ“ æ—  reloadï¼ˆä¸ç›‘å¬ä»£ç å˜åŒ–ï¼‰      â”‚
â”‚   âœ“ PID 1 è®¾ä¸ºä¸»è¿›ç¨‹                â”‚
â”‚   âœ“ ç»‘å®š 0.0.0.0:8000               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. ä¿¡å·å¤„ç†ï¼ˆä¼˜é›…å…³é—­ï¼‰              â”‚
â”‚   âœ“ SIGTERM -> 30 ç§’ä¼˜é›…å…³é—­         â”‚
â”‚   âœ“ SIGINT -> å¿«é€Ÿå…³é—­               â”‚
â”‚   âœ“ æ‰€æœ‰è¿æ¥å®Œæˆåæ‰é€€å‡º             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. æ—¥å¿—ç®¡ç†                          â”‚
â”‚   âœ“ æ‰€æœ‰æ—¥å¿—è¾“å‡ºåˆ° stdout/stderr     â”‚
â”‚   âœ“ Docker æ—¥å¿—é©±åŠ¨æ¥ç®¡              â”‚
â”‚   âœ“ åœ¨ Coolify UI ä¸­æŸ¥çœ‹             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. å¥åº·æ£€æŸ¥ï¼ˆCoolify è‡ªåŠ¨ï¼‰          â”‚
â”‚   âœ“ æ¯ 30 ç§’è¯·æ±‚ /health             â”‚
â”‚   âœ“ è¿ç»­ 3 æ¬¡å¤±è´¥åˆ™é‡å¯å®¹å™¨          â”‚
â”‚   âœ“ 5 ç§’å¯åŠ¨å®½é™æœŸ                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç”Ÿäº§å¯åŠ¨æ–‡ä»¶

**å…³é”®æ–‡ä»¶ï¼š** `scripts/container/entrypoint.sh`

```bash
#!/bin/bash
set -e

# å¯¼å…¥å…±äº«åº“
source /app/scripts/lib/ui.sh
source /app/scripts/lib/utils.sh
source /app/scripts/lib/logging.sh
source /app/scripts/lib/signals.sh
source /app/scripts/lib/preflight.sh
source /app/scripts/lib/database.sh

# é…ç½®
APP_DIR="/app"
ENVIRONMENT="${ENVIRONMENT:-production}"

# è®¾ç½®æ—¥å¿—ï¼ˆå®¹å™¨è¾“å‡ºåˆ° stdoutï¼‰
setup_container_logging

# è®¾ç½®ä¿¡å·å¤„ç†
setup_signal_handlers

# è¿è¡Œé¢„æ£€æŸ¥
run_all_checks || exit 1

# æ•°æ®åº“è¿ç§»ï¼ˆå…³é”®ï¼‰
run_database_migration || exit 1

# æ„å»ºå‰ç«¯
cd "$APP_DIR/frontend"
npm ci --production && npm run build

# å¯åŠ¨åç«¯ï¼ˆ4 workersï¼‰
cd "$APP_DIR"
WORKERS=$(get_optimal_workers)
python -m uvicorn src.main:app \
    --host 0.0.0.0 \
    --port 8000 \
    --workers "$WORKERS" \
    --access-log &
BACKEND_PID=$!

# ç­‰å¾…åç«¯å°±ç»ª
sleep 2
check_backend_health || exit 1

# ç­‰å¾…ä¿¡å·ï¼ˆä¿æŒå®¹å™¨è¿è¡Œï¼‰
wait $BACKEND_PID
```

### ç”Ÿäº§ç¯å¢ƒç‰¹ç‚¹

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **å¯åŠ¨è„šæœ¬** | `scripts/container/entrypoint.sh` |
| **çƒ­é‡è½½** | âŒ ä¸æ”¯æŒï¼ˆç”Ÿäº§ä¼˜åŒ–ï¼‰ |
| **å¯åŠ¨æ—¶é—´** | 20-30 ç§’ï¼ˆåŒ…æ‹¬æ•°æ®åº“è¿ç§»ï¼‰ |
| **æ—¥å¿—è¾“å‡º** | stdout/stderrï¼ˆDocker æ¥ç®¡ï¼‰ |
| **å¤šè¿›ç¨‹** | 4 ä¸ª Uvicorn workers |
| **æ•°æ®åº“** | äº‘ç«¯ PostgreSQLï¼ˆè‡ªåŠ¨è¿ç§»ï¼‰ |
| **å…³é—­æ–¹å¼** | SIGTERM â†’ 30 ç§’ä¼˜é›…å…³é—­ |
| **ç›‘æ§** | Coolify è‡ªåŠ¨å¥åº·æ£€æŸ¥ |

### Coolify é…ç½®

**åœ¨ Coolify UI ä¸­è®¾ç½®ï¼š**

```yaml
# åŸºæœ¬é…ç½®
æº: GitHub repository
Dockerfile: ./Dockerfile
æ„å»ºä¸Šä¸‹æ–‡: ./

# ç¯å¢ƒå˜é‡
DATABASE_URL=postgresql+asyncpg://user:pass@host:5432/db
ENVIRONMENT=production
ANTHROPIC_API_KEY=sk-xxx
CORS_ORIGINS=https://yourdomain.com
LOG_LEVEL=info
WORKERS=4

# å¥åº·æ£€æŸ¥
è·¯å¾„: /health
æ–¹æ³•: GET
è¶…æ—¶: 10s
æ£€æŸ¥é—´éš”: 30s
é‡è¯•æ¬¡æ•°: 3
å¯åŠ¨å®½é™æœŸ: 5s

# ç«¯å£
å®¹å™¨ç«¯å£: 8000
æš´éœ²ç«¯å£: 8000
```

---

## ğŸ”„ ä¸¤ç§ç¯å¢ƒå¯¹æ¯”

### è¯¦ç»†å¯¹æ¯”è¡¨

| ç»´åº¦ | å¼€å‘ç¯å¢ƒ | ç”Ÿäº§ç¯å¢ƒ |
|------|---------|---------|
| **å¯åŠ¨è„šæœ¬** | `scripts/dev/start.sh` | `scripts/container/entrypoint.sh` |
| **è¿è¡Œæ–¹å¼** | ç›´æ¥åœ¨æœ¬åœ°è¿è¡Œ | Docker å®¹å™¨å†…è¿è¡Œ |
| **è¿›ç¨‹ç®¡ç†** | æ‰‹åŠ¨åå°å¯åŠ¨ | Docker å®¹å™¨ç®¡ç† |
| **çƒ­é‡è½½** | âœ… Uvicorn reload + Vite HMR | âŒ ç”Ÿäº§ä¼˜åŒ–ï¼Œæ—  reload |
| **æ—¥å¿—è¾“å‡º** | ç»ˆç«¯ + æ–‡ä»¶ (`logs/dev/`) | stdout/stderrï¼ˆDocker æ¥ç®¡ï¼‰ |
| **ä¼˜é›…å…³é—­** | Ctrl+C ï¼ˆç«‹å³ï¼‰ | SIGTERM ï¼ˆ30 ç§’å®½é™æœŸï¼‰ |
| **é¢„æ£€æŸ¥** | âœ… å¿«é€Ÿï¼ˆä»…å¿…è¦é¡¹ï¼‰ | âœ… å®Œæ•´ï¼ˆç”Ÿäº§çº§ï¼‰ |
| **æ•°æ®åº“è¿ç§»** | æ‰‹åŠ¨è¿è¡Œ `alembic upgrade head` | è‡ªåŠ¨è¿è¡Œ |
| **å‰ç«¯æ„å»º** | npm run devï¼ˆå¼€å‘æœåŠ¡å™¨ï¼‰ | npm run build + npm ci --production |
| **å¤šè¿›ç¨‹** | âŒ å•è¿›ç¨‹ | âœ… 4 ä¸ª Uvicorn workers |
| **å¥åº·æ£€æŸ¥** | æ‰‹åŠ¨æ£€æŸ¥ `http://localhost:8000/health` | Coolify è‡ªåŠ¨æ¯ 30 ç§’æ£€æŸ¥ |
| **CPU/å†…å­˜** | æ— é™åˆ¶ï¼ˆæœ¬åœ°èµ„æºï¼‰ | å—é™ï¼ˆå®¹å™¨é…é¢ï¼‰ |
| **å¯åŠ¨æ—¶é—´** | 10-15 ç§’ | 20-30 ç§’ï¼ˆå«æ•°æ®åº“è¿ç§»ï¼‰ |
| **è®¿é—®åœ°å€** | `localhost:8000/5173` | `https://yourdomain.com` ï¼ˆTraefik è·¯ç”±ï¼‰ |

---

## ğŸ“‚ é¡¹ç›®æ–‡ä»¶ç»“æ„ï¼ˆè§„åˆ’ï¼‰

### å½“å‰å­˜åœ¨çš„æ–‡ä»¶

```
scripts/
â”œâ”€â”€ dev.sh                      âœ… å·²å­˜åœ¨ï¼ˆå¿«é€Ÿå¯åŠ¨ï¼‰
â”œâ”€â”€ build.sh                    âœ… å·²å­˜åœ¨ï¼ˆDocker æ„å»ºï¼‰
â””â”€â”€ test-docker.sh              âœ… å·²å­˜åœ¨ï¼ˆå®¹å™¨æµ‹è¯•ï¼‰

Dockerfile                       âœ… å·²å­˜åœ¨ï¼ˆå¤šé˜¶æ®µæ„å»ºï¼‰
docker-compose.yml              âœ… å·²å­˜åœ¨ï¼ˆCoolify é…ç½®ï¼‰
Makefile                         âœ… å·²å­˜åœ¨ï¼ˆä¾¿æ·å‘½ä»¤ï¼‰

backend/.env.example            âœ… å·²å­˜åœ¨
frontend/.env.example           âœ… å·²å­˜åœ¨
```

### è§„åˆ’ä¸­çš„æ–‡ä»¶ç»“æ„ï¼ˆå®Œæ•´å®ç°ï¼‰

```
scripts/
â”œâ”€â”€ lib/                        ğŸ“‹ è§„åˆ’ä¸­ï¼ˆå…±äº«åº“ï¼‰
â”‚   â”œâ”€â”€ ui.sh                  # é¢œè‰²å’Œ UI è¾“å‡º
â”‚   â”œâ”€â”€ utils.sh               # é€šç”¨å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ logging.sh             # æ—¥å¿—ç®¡ç†ï¼ˆæ–‡ä»¶+stdoutï¼‰
â”‚   â”œâ”€â”€ signals.sh             # ä¿¡å·å¤„ç†ï¼ˆä¼˜é›…å…³é—­ï¼‰
â”‚   â”œâ”€â”€ preflight.sh           # é¢„æ£€æŸ¥ï¼ˆä¸¤ç¯å¢ƒå…±ç”¨ï¼‰
â”‚   â”œâ”€â”€ database.sh            # æ•°æ®åº“æ“ä½œ
â”‚   â””â”€â”€ health.sh              # å¥åº·æ£€æŸ¥
â”‚
â”œâ”€â”€ dev/                        ğŸ“‹ è§„åˆ’ä¸­ï¼ˆå¼€å‘ä¸“ç”¨ï¼‰
â”‚   â”œâ”€â”€ start.sh               # å¼€å‘å¯åŠ¨è„šæœ¬
â”‚   â””â”€â”€ config.env             # å¼€å‘é…ç½®
â”‚
â”œâ”€â”€ container/                  ğŸ“‹ è§„åˆ’ä¸­ï¼ˆå®¹å™¨ä¸“ç”¨ï¼‰
â”‚   â”œâ”€â”€ entrypoint.sh          # å®¹å™¨å¯åŠ¨è„šæœ¬ï¼ˆå½“å‰ ENTRYPOINTï¼‰
â”‚   â”œâ”€â”€ config.env             # å®¹å™¨é…ç½®
â”‚   â””â”€â”€ supervisord.conf       # å¯é€‰ï¼šè¿›ç¨‹ç®¡ç†å™¨
â”‚
â”œâ”€â”€ config/                     ğŸ“‹ è§„åˆ’ä¸­ï¼ˆå…±äº«é…ç½®ï¼‰
â”‚   â”œâ”€â”€ dev.env
â”‚   â”œâ”€â”€ test.env
â”‚   â””â”€â”€ prod.env
â”‚
â””â”€â”€ docker/                     ğŸ“‹ è§„åˆ’ä¸­ï¼ˆDocker ç›¸å…³ï¼‰
    â”œâ”€â”€ Dockerfile             # å¤šé˜¶æ®µæ„å»º
    â”œâ”€â”€ .dockerignore
    â””â”€â”€ docker-compose.dev.yml
```

---

## ğŸš€ å®æ–½è·¯çº¿å›¾

### ç°çŠ¶ï¼ˆå·²å®Œæˆï¼‰

âœ… **å½“å‰å·²æœ‰**ï¼š
- `bash scripts/dev.sh` - å¿«é€Ÿå¯åŠ¨å¼€å‘ç¯å¢ƒ
- `Dockerfile` - å¤šé˜¶æ®µæ„å»º
- `docker-compose.yml` - Coolify é…ç½®
- `Makefile` - ä¾¿æ·å‘½ä»¤

### åç»­è§„åˆ’ï¼ˆæ¨èå®æ–½ï¼‰

#### Phase 1ï¼ˆDay 1-2ï¼‰ï¼šåŸºç¡€æ¡†æ¶
- [ ] åˆ›å»º `scripts/lib/` ç›®å½•ç»“æ„
- [ ] å®ç°å…±äº«åº“ï¼ˆui.sh, utils.sh, logging.sh ç­‰ï¼‰
- [ ] ç¯å¢ƒæ£€æµ‹æœºåˆ¶
- [ ] é…ç½®æ–‡ä»¶æ¨¡æ¿

#### Phase 2ï¼ˆDay 3ï¼‰ï¼šå¼€å‘å¯åŠ¨è„šæœ¬
- [ ] å¼€å‘ç¯å¢ƒå¯åŠ¨è„šæœ¬ï¼ˆscripts/dev/start.shï¼‰
- [ ] æœ¬åœ°è¿è¡Œæµ‹è¯•
- [ ] æ›´æ–° Makefile

#### Phase 3ï¼ˆDay 4ï¼‰ï¼šå®¹å™¨å¯åŠ¨è„šæœ¬
- [ ] å®¹å™¨å¯åŠ¨è„šæœ¬ï¼ˆscripts/container/entrypoint.shï¼‰
- [ ] å®Œå–„ Dockerfile
- [ ] æœ¬åœ°å®¹å™¨æµ‹è¯•

#### Phase 4ï¼ˆDay 5ï¼‰ï¼šå¢å¼ºåŠŸèƒ½
- [ ] æ—¥å¿—ç®¡ç†å®Œå–„
- [ ] å¥åº·æ£€æŸ¥é›†æˆ
- [ ] ä¿¡å·å¤„ç†å®Œå–„

#### Phase 5ï¼ˆDay 6ï¼‰ï¼šæ–‡æ¡£å’Œéƒ¨ç½²
- [ ] å®Œæ•´æ–‡æ¡£
- [ ] Coolify é…ç½®æŒ‡å—
- [ ] æ•…éšœæ’é™¤æŒ‡å—

---

## ğŸ’¡ å…³é”®æŠ€æœ¯ç»†èŠ‚

### 1. ç¯å¢ƒæ£€æµ‹æœºåˆ¶

```bash
# åœ¨ lib/utils.sh ä¸­
detect_environment() {
    # æ£€æŸ¥æ˜¯å¦åœ¨ Docker å†…
    if [ -f "/.dockerenv" ]; then
        ENVIRONMENT="container"
        IS_CONTAINER=true
    elif grep -q "docker" /proc/1/cgroup 2>/dev/null; then
        ENVIRONMENT="container"
        IS_CONTAINER=true
    else
        ENVIRONMENT="development"
        IS_CONTAINER=false
    fi

    export ENVIRONMENT IS_CONTAINER
}

# ä½¿ç”¨
if [ "$IS_CONTAINER" = "true" ]; then
    # å®¹å™¨å¯åŠ¨é€»è¾‘
    log_to_stdout "Running in container"
else
    # æœ¬åœ°å¯åŠ¨é€»è¾‘
    log_to_file "Running locally"
fi
```

### 2. ä¼˜é›…å…³é—­å¤„ç†

```bash
# åœ¨ lib/signals.sh ä¸­
setup_signal_handlers() {
    # SIGTERM: ä¼˜é›…å…³é—­ï¼ˆå®¹å™¨ Docker å‘é€ï¼‰
    trap 'graceful_shutdown SIGTERM' SIGTERM

    # SIGINT: ç”¨æˆ· Ctrl+C
    trap 'graceful_shutdown SIGINT' INT

    # EXIT: æ¸…ç†èµ„æº
    trap 'cleanup_resources' EXIT
}

graceful_shutdown() {
    local signal=$1
    log_info "launcher" "Received $signal, shutting down..."

    # é€šçŸ¥åç«¯ä¼˜é›…å…³é—­ï¼ˆ30 ç§’å®½é™æœŸï¼‰
    kill -TERM $BACKEND_PID

    # ç­‰å¾…æœ€å¤š 30 ç§’
    local wait_count=0
    while kill -0 $BACKEND_PID 2>/dev/null && [ $wait_count -lt 30 ]; do
        sleep 1
        wait_count=$((wait_count + 1))
    done

    # å¦‚æœè¿˜åœ¨è¿è¡Œï¼Œå¼ºåˆ¶æ€æ­»
    if kill -0 $BACKEND_PID 2>/dev/null; then
        kill -9 $BACKEND_PID 2>/dev/null || true
    fi

    exit 0
}
```

### 3. Docker å¤šé˜¶æ®µæ„å»º

```dockerfile
# Stage 1: Python åç«¯æ„å»º
FROM python:3.12-slim as backend-builder
WORKDIR /app
COPY backend/pyproject.toml ./
RUN pip install poetry && poetry install --no-dev

# Stage 2: Node å‰ç«¯æ„å»º
FROM node:20-slim as frontend-builder
WORKDIR /app/frontend
COPY frontend/package.json ./
RUN npm ci && npm run build

# Stage 3: è¿è¡Œæ—¶
FROM python:3.12-slim
WORKDIR /app

# å®‰è£…ç³»ç»Ÿä¾èµ–
RUN apt-get update && apt-get install -y curl postgresql-client

# å¤åˆ¶æ„å»ºäº§ç‰©
COPY --from=backend-builder /app/.venv /app/.venv
COPY --from=frontend-builder /app/frontend/dist /app/frontend/dist
COPY scripts /app/scripts

# å¯åŠ¨
ENTRYPOINT ["/app/scripts/container/entrypoint.sh"]
```

---

## ğŸ“Š æœ€ç»ˆå†³ç­–æ€»ç»“

### âœ… æ¨èé‡‡çº³

**"åŒç¯å¢ƒæ··åˆå¯åŠ¨ç³»ç»Ÿ"**

**æ ¸å¿ƒè®¾è®¡åŸåˆ™ï¼š**

1. **å…±äº«åº“ä¼˜å…ˆ** - ä¸¤ä¸ªç¯å¢ƒéƒ½ç”¨ `scripts/lib/` ä¸­çš„åŠŸèƒ½
2. **ç¯å¢ƒéš”ç¦»** - åˆ†ç¦»çš„å¯åŠ¨è„šæœ¬é’ˆå¯¹å„è‡ªç¯å¢ƒä¼˜åŒ–
3. **è‡ªåŠ¨æ£€æµ‹** - è„šæœ¬è‡ªåŠ¨è¯†åˆ«è¿è¡Œç¯å¢ƒå¹¶è°ƒæ•´è¡Œä¸º
4. **ä¼˜é›…å…³é—­** - å®Œæ•´çš„ä¿¡å·å¤„ç†å’Œèµ„æºæ¸…ç†
5. **é›¶é¢å¤–ä¾èµ–** - çº¯ Bash å®ç°ï¼Œæ— å¤–éƒ¨ä¾èµ–

### å…³é”®ä¼˜åŠ¿

- âœ… **å¼€å‘é«˜æ•ˆ**ï¼šçƒ­é‡è½½ + å¿«é€Ÿå¯åœ + ä¾¿æ·è°ƒè¯•
- âœ… **ç”Ÿäº§å¯é **ï¼šå®Œæ•´é¢„æ£€æŸ¥ + è‡ªåŠ¨è¿ç§» + ä¼˜é›…å…³é—­
- âœ… **è¿ç»´å‹å¥½**ï¼šç»Ÿä¸€æµç¨‹ + æ¸…æ™°æ—¥å¿— + ç®€åŒ–éƒ¨ç½²
- âœ… **æˆæœ¬æ§åˆ¶**ï¼šæ— éœ€é¢å¤–å·¥å…· + è½»é‡çº§å®¹å™¨

---

## ğŸ“ ä½¿ç”¨æŒ‡å—

### å¼€å‘æ—¶

```bash
# ç®€å•æ–¹å¼
bash scripts/dev.sh

# æˆ–ä½¿ç”¨ Makefile
make dev

# è®¿é—®
Frontend: http://localhost:5173
Backend:  http://localhost:8000/docs
```

### éƒ¨ç½²æ—¶

```bash
# æ¨é€åˆ° GitHub
git push origin main

# Coolify è‡ªåŠ¨ï¼š
# 1. æ‹‰å–ä»£ç 
# 2. æ„å»º Docker é•œåƒ
# 3. è¿è¡Œå®¹å™¨ï¼ˆæ‰§è¡Œ entrypoint.shï¼‰
# 4. è‡ªåŠ¨å¥åº·æ£€æŸ¥å’Œç›‘æ§
```

---

**æ–‡æ¡£ç”Ÿæˆæ—¥æœŸ**: 2025å¹´11æœˆ15æ—¥
**åŸºäºåˆ†æ**: UNIFIED_STARTUP_SOLUTION_ANALYSIS.md
**æ¨èå¯è¡Œæ€§**: â­â­â­â­â­ é«˜åº¦å¯è¡Œ

