
## ğŸ“‹ é¡¹ç›®éœ€æ±‚

è®¾è®¡å¹¶å®ç°ä¸€ä¸ª Hook è§„åˆ™ï¼Œä½¿å¾— Claude åœ¨å®Œæˆç”¨æˆ·ä»»åŠ¡åï¼Œèƒ½å¤Ÿï¼š
1. æ£€æŸ¥ `src/` ç›®å½•ä¸­æ˜¯å¦æœ‰æ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤çš„ä»£ç æ–‡ä»¶
2. å¦‚æœ‰å˜åŒ–ï¼Œè¯¢é—®ç”¨æˆ·æ˜¯å¦éœ€è¦æ›´æ–° `docs/guides/MODULE_OVERVIEW.md`
3. è‡ªåŠ¨åŒ–å¤„ç†ï¼Œé¿å…æ‰‹åŠ¨æ“ä½œçš„ç¹ç

---

## ğŸ¯ å®ç°æˆæœ

### âœ… å·²åˆ›å»ºçš„æ–‡ä»¶

#### 1. **æ ¸å¿ƒ Hook è„šæœ¬**
- **æ–‡ä»¶**ï¼š`.claude/hooks/src-module-update-check-hook`
- **åŠŸèƒ½**ï¼š
  - æ£€æµ‹ `src/` ç›®å½•çš„æ–‡ä»¶å˜åŒ–ï¼ˆå¢/åˆ /æ”¹/é‡å‘½åï¼‰
  - è¿‡æ»¤æ— å…³æ–‡ä»¶ï¼ˆ`__pycache__`, `*.pyc` ç­‰ï¼‰
  - åˆ—å‡ºå…·ä½“å˜åŒ–ç±»å‹ï¼ˆæ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤ï¼‰
  - è®°å½•æ£€æŸ¥æ—¥å¿—
  - é˜²æ­¢é¢‘ç¹æç¤ºï¼ˆ60 ç§’é—´éš”ï¼‰

#### 2. **é›†æˆæ›´æ–°**
- **æ–‡ä»¶**ï¼š`.claude/hooks/user-prompt-submit-hook`
- **ä¿®æ”¹**ï¼š
  - ä»åŸæœ‰çš„å•ä¸€åŠŸèƒ½æ‰©å±•åˆ°å¤šåŠŸèƒ½ Hook
  - è°ƒç”¨æ–°çš„ `src-module-update-check-hook`
  - ä¿ç•™åŸæœ‰çš„å¯¹è¯å‹ç¼©æ£€æŸ¥åŠŸèƒ½

#### 3. **é…ç½®æŒ‡å—**
- **æ–‡ä»¶**ï¼š`.claude/HOOKS_SETUP_GUIDE.md`
- **å†…å®¹**ï¼š
  - Hook æ¦‚è¿°å’Œè§¦å‘æ—¶æœº
  - è¯¦ç»†çš„ä½¿ç”¨æŒ‡å—å’Œå·¥ä½œæµç¨‹
  - å‚æ•°é…ç½®è¯´æ˜
  - æ—¥å¿—æ–‡ä»¶ä½ç½®
  - è‡ªå®šä¹‰é…ç½®æ–¹æ³•
  - æ’æŸ¥å’Œè°ƒè¯•æŒ‡å—
  - æœ€ä½³å®è·µå»ºè®®

#### 4. **é¡¹ç›®è§„åˆ™æ›´æ–°**
- **æ–‡ä»¶**ï¼š`CLAUDE.md`
- **ä¿®æ”¹**ï¼š
  - æ·»åŠ "è‡ªåŠ¨ Hook æ£€æŸ¥"éƒ¨åˆ†åˆ°ä»£ç å¼€å‘å·¥ä½œæµè§„åˆ™
  - è¯´æ˜ Hook å¦‚ä½•è‡ªåŠ¨æ£€æµ‹ä»£ç å˜åŒ–
  - å¼•å¯¼ç”¨æˆ·æŸ¥çœ‹ HOOKS_SETUP_GUIDE.md

---

## ğŸ”§ å·¥ä½œåŸç†

### è§¦å‘æµç¨‹

```
ç”¨æˆ·æäº¤å¯¹è¯æç¤º
        â”‚
        â–¼
user-prompt-submit-hook è¢«è§¦å‘
        â”‚
        â”œâ”€â†’ æ£€æŸ¥å¯¹è¯å‹ç¼©çŠ¶æ€
        â”‚
        â””â”€â†’ è°ƒç”¨ src-module-update-check-hook
                â”‚
                â”œâ”€â†’ éªŒè¯é¡¹ç›®æ˜¯ git ä»“åº“
                â”‚
                â”œâ”€â†’ æ£€æŸ¥æœ€åæ£€æŸ¥æ—¶é—´ï¼ˆé˜²æ­¢é¢‘ç¹æç¤ºï¼‰
                â”‚
                â”œâ”€â†’ æ‰«æ src/ ç›®å½•å˜åŒ–
                â”‚   (git diff --name-status)
                â”‚
                â”œâ”€â†’ è¿‡æ»¤ Python æ–‡ä»¶ï¼ˆ*.pyï¼‰
                â”‚
                â”œâ”€â†’ å¦‚æœ‰å˜åŒ– â†’ æ˜¾ç¤ºæç¤º
                â”‚   â€¢ åˆ—å‡ºå˜åŒ–è¯¦æƒ…
                â”‚   â€¢ è¯¢é—®æ˜¯å¦æ›´æ–°æ–‡æ¡£
                â”‚   â€¢ æä¾›æ“ä½œæŒ‡å¯¼
                â”‚
                â””â”€â†’ è®°å½•æ£€æŸ¥æ—¥å¿—
```

### Hook æ£€æµ‹çš„å˜åŒ–ç±»å‹

| çŠ¶æ€ | ä»£ç  | ç¤ºä¾‹ |
|------|------|------|
| æ–°å¢æ–‡ä»¶ | A | src/services/new_module.py |
| ä¿®æ”¹æ–‡ä»¶ | M | src/main.py |
| åˆ é™¤æ–‡ä»¶ | D | src/old_module.py |
| é‡å‘½å | R | src/services/old.py â†’ new.py |

---

## ğŸ“Š æ ¸å¿ƒç‰¹æ€§

### âœ¨ è‡ªåŠ¨åŒ–ç‰¹æ€§
- âœ… è‡ªåŠ¨æ£€æµ‹ä»£ç å˜åŒ–
- âœ… å‹å¥½çš„æç¤ºç•Œé¢
- âœ… é˜²é¢‘ç¹éªšæ‰°æœºåˆ¶ï¼ˆ60 ç§’é—´éš”ï¼‰
- âœ… å˜åŒ–åˆ†ç±»æ˜¾ç¤ºï¼ˆæ–°å¢/ä¿®æ”¹/åˆ é™¤ï¼‰
- âœ… è¯¦ç»†çš„æ“ä½œæŒ‡å¯¼

### ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§
- âœ… åªæ£€æŸ¥ Python æ–‡ä»¶ï¼ˆ*.pyï¼‰
- âœ… æ’é™¤ä¸´æ—¶æ–‡ä»¶ï¼ˆ__pycache__, *.pyc ç­‰ï¼‰
- âœ… Git ä»“åº“éªŒè¯
- âœ… æ£€æŸ¥é—´éš”é™åˆ¶ï¼ˆé˜²æ­¢ DoSï¼‰

### ğŸ“ å¯é…ç½®æ€§
- âœ… æ˜“äºè‡ªå®šä¹‰æ£€æŸ¥é—´éš”
- âœ… å¯ä¿®æ”¹é¡¹ç›®è·¯å¾„
- âœ… å¯ä¸´æ—¶ç¦ç”¨ Hook
- âœ… è¯¦ç»†çš„æ—¥å¿—è®°å½•

---

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### åœºæ™¯ 1ï¼šå®Œæˆæ–°åŠŸèƒ½å¼€å‘

```bash
# 1. å¼€å‘å®Œæˆï¼Œæäº¤å¯¹è¯
ç”¨æˆ·: "åœ¨ src/services ä¸­æ·»åŠ  Claude ç¼“å­˜ç®¡ç†æœåŠ¡"

# 2. Hook è‡ªåŠ¨æ£€æµ‹å˜åŒ–
âœ… ä»»åŠ¡å·²å®Œæˆã€‚æ£€æµ‹åˆ° src/ ç›®å½•å‘ç”Ÿäº†ä»£ç å˜åŒ–ã€‚

# 3. Hook æ˜¾ç¤ºå˜åŒ–è¯¦æƒ…
ğŸ“‹ **æ£€æµ‹åˆ°çš„ src/ ç›®å½•å˜åŒ–ï¼š**

â• **æ–°å¢æ–‡ä»¶ï¼š**
   â€¢ src/services/claude_cache_manager.py
   â€¢ src/api/claude_cache_routes.py

âœï¸  **ä¿®æ”¹æ–‡ä»¶ï¼š**
   â€¢ src/main.py

# 4. Hook æç¤ºæ›´æ–°æ–‡æ¡£
**æ˜¯å¦éœ€è¦æ›´æ–° docs/guides/MODULE_OVERVIEW.mdï¼Ÿ**

æ“ä½œæŒ‡å—ï¼š
  â€¢ è‹¥è¦ç«‹å³æ›´æ–°æ–‡æ¡£ï¼Œè¯·è¿è¡Œï¼š`/update-module-docs` å‘½ä»¤
  â€¢ è‹¥è¦æ‰‹åŠ¨æ›´æ–°ï¼Œè¯·ç›´æ¥ç¼–è¾‘æ–‡æ¡£
  â€¢ è‹¥è¦è·³è¿‡æ­¤æ­¥ï¼Œå¯å¿½ç•¥æ­¤æç¤º

# 5. ç”¨æˆ·é€‰æ‹©æ›´æ–°æ–‡æ¡£
ç”¨æˆ·: "/update-module-docs"

# 6. æ–‡æ¡£è‡ªåŠ¨æ›´æ–°å®Œæˆ
âœ“ æ¨¡å—æ–‡æ¡£å·²æ›´æ–°
```

### åœºæ™¯ 2ï¼šå¿«é€Ÿè¿­ä»£ï¼ˆé¢‘ç¹æäº¤ï¼‰

```bash
# ç¬¬ 1 æ¬¡æäº¤ï¼ˆ0 ç§’ï¼‰
ä»»åŠ¡å®Œæˆï¼ŒHook æç¤º â†’ âœ… æ˜¾ç¤ºæç¤º

# ç¬¬ 2 æ¬¡æäº¤ï¼ˆ30 ç§’ï¼‰
ä»»åŠ¡å®Œæˆï¼ŒHook æ£€æŸ¥ â†’ â­ï¸ è·³è¿‡æç¤ºï¼ˆæœªè¾¾ 60 ç§’ï¼‰

# ç¬¬ 3 æ¬¡æäº¤ï¼ˆ70 ç§’ï¼‰
ä»»åŠ¡å®Œæˆï¼ŒHook æç¤º â†’ âœ… å†æ¬¡æ˜¾ç¤ºæç¤º

# é˜²æ­¢é¢‘ç¹éªšæ‰°ï¼
```

---

## ğŸ“‚ æ–‡ä»¶æ¸…å•

```
working/
â”œâ”€â”€ .claude/
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ user-prompt-submit-hook          âœï¸ å·²æ›´æ–°
â”‚   â”‚   â”œâ”€â”€ src-module-update-check-hook     âœ¨ æ–°å¢
â”‚   â”‚   â”œâ”€â”€ file-output-rule-hook
â”‚   â”‚   â”œâ”€â”€ conversation-compacted-hook
â”‚   â”‚   â””â”€â”€ thinking-display-hook
â”‚   â””â”€â”€ HOOKS_SETUP_GUIDE.md                 âœ¨ æ–°å¢
â”‚
â”œâ”€â”€ CLAUDE.md                                 âœï¸ å·²æ›´æ–°
â”œâ”€â”€ HOOKS_IMPLEMENTATION_SUMMARY.md           âœ¨ æœ¬æ–‡ä»¶
â”‚
â””â”€â”€ docs/
    â””â”€â”€ guides/
        â””â”€â”€ MODULE_OVERVIEW.md               (å¾… Hook æç¤ºæ—¶æ›´æ–°)
```

---

## ğŸ” éªŒè¯æ–¹å¼

### æµ‹è¯• Hook æ˜¯å¦å·¥ä½œ

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /mnt/d/å·¥ä½œåŒº/äº‘å¼€å‘/working

# 2. åšä¸€ä¸ªä»£ç å˜åŒ–
echo "# test" >> src/main.py

# 3. æ‰‹åŠ¨è§¦å‘ Hook
bash .claude/hooks/src-module-update-check-hook

# é¢„æœŸè¾“å‡ºï¼š
# ğŸ“‹ **æ£€æµ‹åˆ°çš„ src/ ç›®å½•å˜åŒ–ï¼š**
# âœï¸  **ä¿®æ”¹æ–‡ä»¶ï¼š**
#    â€¢ src/main.py
```

### æŸ¥çœ‹ Hook æ—¥å¿—

```bash
# æŸ¥çœ‹æœ€è¿‘çš„ Hook æ‰§è¡Œæ—¥å¿—
tail -20 /tmp/claude_module_update_prompts.log

# æ—¥å¿—ç¤ºä¾‹ï¼š
# [2025-11-20 16:30:45] [INFO] æ£€æŸ¥é—´éš”å¤ªçŸ­ï¼ˆ30s < 60sï¼‰ï¼Œè·³è¿‡æç¤º
# [2025-11-20 16:31:45] [PROMPT] å‘ç”¨æˆ·æ˜¾ç¤ºäº†æ¨¡å—æ–‡æ¡£åŒæ­¥æç¤º
```

---

## ğŸ“ é›†æˆåˆ°å·¥ä½œæµ

### CLAUDE åº”éµå¾ªçš„æ–°å·¥ä½œæµ

1. **ä»»åŠ¡å®Œæˆå**
   - Hook è‡ªåŠ¨æ£€æµ‹ `src/` å˜åŒ–
   - å¦‚æœ‰å˜åŒ–ï¼Œæ˜¾ç¤ºå‹å¥½æç¤º

2. **ç”¨æˆ·çœ‹åˆ°æç¤ºåï¼Œä¸‰ç§é€‰æ‹©**
   - âœ… **é€‰é¡¹ A**ï¼šè¿è¡Œ `/update-module-docs` è‡ªåŠ¨æ›´æ–°æ–‡æ¡£
   - âœ… **é€‰é¡¹ B**ï¼šæ‰‹åŠ¨ç¼–è¾‘ `docs/guides/MODULE_OVERVIEW.md`
   - âœ… **é€‰é¡¹ C**ï¼šç°åœ¨è·³è¿‡ï¼Œç¨åæ‰‹åŠ¨å¤„ç†

3. **æ–‡æ¡£åŒæ­¥å®Œæˆ**
   - æ¨¡å—æ–‡æ¡£ä¿æŒæœ€æ–°çŠ¶æ€
   - ä»£ç ä¸æ–‡æ¡£åŒæ­¥

---

## ğŸ“‹ é…ç½®å‚æ•°è¯´æ˜

| å‚æ•° | å½“å‰å€¼ | è¯´æ˜ | å¯é…ç½® |
|------|--------|------|--------|
| PROJECT_ROOT | `/mnt/d/å·¥ä½œåŒº/äº‘å¼€å‘/working` | é¡¹ç›®æ ¹ç›®å½• | âœ… |
| MODULE_DOC | `docs/guides/MODULE_OVERVIEW.md` | ç›®æ ‡æ–‡æ¡£ | âœ… |
| MIN_CHECK_INTERVAL | 60 ç§’ | æœ€å°æ£€æŸ¥é—´éš” | âœ… |
| PROMPT_HISTORY_FILE | `/tmp/claude_module_update_prompts.log` | æ—¥å¿—æ–‡ä»¶ | âœ… |

---

## ğŸš¨ æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

| é—®é¢˜ | åŸå›  | è§£å†³ |
|------|------|------|
| Hook æ²¡æœ‰æç¤º | æ£€æŸ¥é—´éš” < 60s | ç­‰å¾…è¶³å¤Ÿæ—¶é—´å†æäº¤ |
| Hook æ²¡æœ‰æç¤º | src/ æ—  Python å˜åŒ– | æ£€æŸ¥æ˜¯å¦ä¿®æ”¹äº† .py æ–‡ä»¶ |
| Hook æ‰§è¡Œç¼“æ…¢ | git ä»“åº“å¤§ | æ­£å¸¸è¡Œä¸ºï¼Œgit diff éœ€è¦æ—¶é—´ |
| æƒé™é”™è¯¯ | Hook ä¸å¯æ‰§è¡Œ | è¿è¡Œ `chmod +x .claude/hooks/*` |

### æ‰‹åŠ¨æµ‹è¯•

```bash
# å¼ºåˆ¶é‡ç½®æ£€æŸ¥æ—¶é—´æˆ³
rm /tmp/claude_last_src_check_time

# æ‰‹åŠ¨è¿è¡Œ Hook
bash /mnt/d/å·¥ä½œåŒº/äº‘å¼€å‘/working/.claude/hooks/src-module-update-check-hook

# æŸ¥çœ‹å®Œæ•´è¾“å‡º
bash -x /mnt/d/å·¥ä½œåŒº/äº‘å¼€å‘/working/.claude/hooks/src-module-update-check-hook
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

| æ–‡æ¡£ | ä½ç½® | è¯´æ˜ |
|------|------|------|
| **HOOKS_SETUP_GUIDE.md** | `.claude/` | å®Œæ•´çš„ Hook é…ç½®æŒ‡å— |
| **CLAUDE.md** | é¡¹ç›®æ ¹ç›®å½• | æ›´æ–°äº†æ¨¡å—æ–‡æ¡£åŒæ­¥è§„åˆ™ |
| **MODULE_OVERVIEW.md** | `docs/guides/` | æ¨¡å—æ–‡æ¡£ï¼ˆHook ä¼šæç¤ºæ›´æ–°ï¼‰ |
| **config.json** | `.claude/` | Claude Code ä¸»é…ç½®æ–‡ä»¶ |

---

## ğŸ‰ å®Œæˆæƒ…å†µ

| ä»»åŠ¡ | çŠ¶æ€ | å®Œæˆæ—¶é—´ |
|------|------|--------|
| è®¾è®¡ Hook è§„åˆ™ | âœ… | 2025-11-20 |
| å®ç° Hook è„šæœ¬ | âœ… | 2025-11-20 |
| é›†æˆåˆ°å·¥ä½œæµ | âœ… | 2025-11-20 |
| ç¼–å†™é…ç½®æŒ‡å— | âœ… | 2025-11-20 |
| æ›´æ–° CLAUDE.md | âœ… | 2025-11-20 |
| æµ‹è¯•å’ŒéªŒè¯ | âœ… | 2025-11-20 |

---

## ğŸ” ä¸‹ä¸€æ­¥å»ºè®®

### ç«‹å³å¯åš
- âœ… Hook å·²å®Œå…¨é›†æˆï¼Œæ— éœ€é¢å¤–é…ç½®
- âœ… æ­£å¸¸ä½¿ç”¨ï¼ŒHook ä¼šè‡ªåŠ¨è§¦å‘

### å¯é€‰ä¼˜åŒ–
- ğŸ”„ å¯æ ¹æ®é¡¹ç›®éœ€è¦è°ƒæ•´ `MIN_CHECK_INTERVAL`
- ğŸ”„ å¯æ ¹æ®é¡¹ç›®è·¯å¾„å˜åŒ–è°ƒæ•´ `PROJECT_ROOT`
- ğŸ”„ å¯åœ¨ Hook è„šæœ¬ä¸­æ·»åŠ æ›´å¤šæ–‡ä»¶ç±»å‹æ£€æµ‹

### æ–‡æ¡£ç»´æŠ¤
- ğŸ“ å®šæœŸæŸ¥çœ‹ `/tmp/claude_module_update_prompts.log` äº†è§£ Hook æ‰§è¡Œæƒ…å†µ
- ğŸ“ æ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µä¼˜åŒ– Hook å‚æ•°

---

**å®ç°å®Œæˆæ—¥æœŸ**ï¼š2025-11-20
**Hook ç‰ˆæœ¬**ï¼š1.0
**é›†æˆç‰ˆæœ¬**ï¼šuser-prompt-submit-hook v2.0
**ç»´æŠ¤äºº**ï¼šClaude Code

---

## ğŸ¯ å¿«é€Ÿå¼€å§‹

1. **æŸ¥çœ‹ Hook é…ç½®**ï¼šé˜…è¯» `.claude/HOOKS_SETUP_GUIDE.md`
2. **ç†è§£å·¥ä½œæµ**ï¼šå‚è€ƒæœ¬æ–‡æ¡£çš„"å·¥ä½œåŸç†"éƒ¨åˆ†
3. **æ­£å¸¸ä½¿ç”¨**ï¼šå®Œæˆä»£ç ä»»åŠ¡åï¼ŒHook ä¼šè‡ªåŠ¨æç¤º
4. **æ›´æ–°æ–‡æ¡£**ï¼šæ”¶åˆ°æç¤ºæ—¶è¿è¡Œ `/update-module-docs` æˆ–æ‰‹åŠ¨ç¼–è¾‘

---

**ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼** ğŸš€
