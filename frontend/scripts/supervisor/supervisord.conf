[supervisord]
nodaemon=true
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
childlogdir=/var/log/supervisor
user=root

[unix_http_server]
file=/var/run/supervisor.sock
chmod=0700

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock

; ============================================
; Backend Service (Python/FastAPI)
; ============================================
[program:backend]
command=python -m uvicorn src.main:app --host 0.0.0.0 --port 8000
directory=/app/backend
autostart=true
autorestart=true
startsecs=10
startretries=5
stopwaitsecs=30
stopasgroup=true
killasgroup=true
redirect_stderr=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
environment=PYTHONUNBUFFERED="1",PYTHONDONTWRITEBYTECODE="1"
priority=100

; ============================================
; Frontend Service (Node.js)
; ============================================
[program:frontend]
command=npm run start
directory=/app/frontend
autostart=true
autorestart=true
startsecs=10
startretries=5
stopwaitsecs=15
stopasgroup=true
killasgroup=true
redirect_stderr=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
environment=NODE_ENV="production"
priority=200

; ============================================
; Health Monitor Service
; ============================================
[program:health_monitor]
command=python /app/scripts/monitor/health_monitor.py
directory=/app
autostart=true
autorestart=true
startsecs=5
startretries=3
redirect_stderr=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
environment=PYTHONUNBUFFERED="1"
priority=300

; ============================================
; Event Listener for Crashes
; ============================================
[eventlistener:crash_notifier]
command=python /app/scripts/monitor/crash_listener.py
events=PROCESS_STATE_FATAL,PROCESS_STATE_EXITED
buffer_size=100
priority=400
